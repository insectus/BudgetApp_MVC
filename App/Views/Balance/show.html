{% extends 'base.html' %}

{% block title %}Bilans{% endblock %}


{% block body %}

<div class="container text-center">
    <div class="row align-items-start">
        <div class="col p-5" >
            <form action="/balance/show" method="post">
                <h3> Pokaż bilans swoich finansów </h3>

                <p>Tu możesz sprawdzić stan swoich finansów.</p>

                <div class="form-group mt-1">
                    <legend class="col-sm-2 col-form-label col-form-label-sm"> Kategoria: </legend>
                    <select class="form-select" multiple aria-label="multiple select example" name = "selectTimePeriode" id="myselect">
                        <option selected value = 0>Bieżący miesiąc</option>
                        <option value = 1>Poprzedni miesiąc</option>
                        <option value = 2>Bieżący rok</option>
                        <option value = 3 data-bs-toggle="modal" data-bs-target="#exampleModal">Niestandardowy</option>
                    </select> 

                    <div class="form-group p-3">
                        <button class="btn btn-success" type="submit" class="btn btn-default">Pokaż bilans</button>
                        <a class="nav-link" href="/balance/new">Anuluj</a>
                    </div> 

                </div>

                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">  
                                <div class="modal-header">
                                    <h4>Wybierz niestatndardowy przedział czasowy</h3>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <fieldset>
                                        <legend class="col-sm-2 col-form-label col-form-label-sm"> Data początku</legend>
                                        <input class="form-control"  type="date" value="current_date" name = "dateBegin" min="2000-01-01" id="dateBegin">
                                    </fieldset>
                                    <fieldset>
                                        <legend class="col-sm-2 col-form-label col-form-label-sm"> Data końca</legend>
                                        <input class="form-control"  type="date" value="current_date" name = "dateEnd" min="2000-01-01" id="dateEnd">
                                    </fieldset>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Zamknij</button>
                                    <button class="btn btn-success" type="submit">Pokaż bilans</button>
                                </div>
                        </div>
                    </div>
                </div>
            </form>                    
            <div class="container text-center">
                <div class="container text-center">
                    <h3>Nowy bilans</h3>
                </div>  
                <div class="row align-items-start">
                    <div class="col">
                        <table class="table table-dark table-striped table-bordered border-light" id="incomes">
                            <thead>
                            <tr>
                                <th colspan="2" scope="col" class="table-success text-center">Przychody</th>
                            </tr>
                            </thead>
                            <tbody>
                                {% for incomeSum in allUserIncomes %}
                            <tr>
                                <td>Suma Twoich przychodów:</td>
                                {% if incomeSum.sum > 0 %}
                                <td  class="text-center"> {{ incomeSum.sum }} zł</td> 
                                {% else %}
                                <td  class="text-center"> 0 zł</td> 
                                {% endif %}
                            </tr>
                            {% endfor %}
                            {% for salary in allSalary %}
                            <tr>
                                <td>Wynagrodzenie:</td>
                                {% if salary.sum > 0 %}
                                <td class="text-center">{{ salary.sum }} zł</td> 
                                {% else %}
                                <td  class="text-center"> 0 zł</td> 
                                {% endif %}                     
                            </tr>
                            {% endfor %}
                            {% for interst in allIntrest %}
                            <tr>
                                <td>Odsetki bankowe:</td>
                                {% if interst.sum > 0 %}
                                 <td class="text-center" value="{{ interst.sum }}" id="intrest">{{ interst.sum }} zł</td>
                                 {% else %}
                                <td  class="text-center"> 0 zł</td> 
                                {% endif %} 
                            </tr>
                            {% endfor %}
                            {% for allegro in allAllegro %}
                            <tr>
                                <td>Sprzedaż na Allegro:</td>
                                {% if allegro.sum > 0 %}
                                <td class="text-center">{{ allegro.sum }} zł</td>
                                {% else %}
                                <td  class="text-center"> 0 zł</td> 
                                {% endif %} 
                            </tr>
                            {% endfor %}
                            {% for another in allAnother %}
                            <tr>
                                <td>Inne przychody:</td>
                                {% if another.sum > 0 %}
                                <td class="text-center">{{ another.sum }} zł</td>
                                {% else %}
                                <td  class="text-center"> 0 zł</td> 
                                {% endif %} 
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="col">
                        <table class="table table-dark table-striped table-bordered border-light" id="expense">
                            <thead>
                                <tr>
                                    <th colspan="2" scope="col" class="table-danger text-center">Wydatki</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Suma Twoich wydatków:</td>
                                    {% if expenseSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}  
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Jedzenie:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Mieszkanie:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Transport:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Telekomunikacja:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Opieka zdrowotna:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Ubranie:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Higiena:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Dzieci:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Rozrywka:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Wycieczka:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Szkolenia:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Książki:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Oszczędności:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Na emeryturę:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Spłata długów:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Darowizna:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                {% for expenseSum in allUserExpenses %}
                                <tr>
                                    <td>Inne wydatki:</td>
                                    {% if incomeSum.sum > 0 %}
                                    <td  class="text-center"> {{ expenseSum.sum }} zł</td>
                                    {% else %}
                                    <td  class="text-center"> 0 zł</td> 
                                    {% endif %}
                                </tr>
                                {% endfor %}
                                </tbody>
                        </table>
                    </div>
                </div>
                <table class="table table-dark table-striped table-bordered border-light" id="incomes">
                    <thead>
                    <tr>
                        <th colspan="2" scope="col" class="table-warning text-center">Twoje saldo to:</th>
                    </tr>
                    </thead>
                    <tbody>
                        {% for expenseSum in allUserExpenses%}
                        {% for incomeSum in allUserIncomes%}
                    <tr>
                        <td colspan="2" class="text-center">{{ incomeSum.sum - expenseSum.sum }} zł</td>
                    </tr>
                    {% if incomeSum.sum > expenseSum.sum %}
                    <tr>
                        <td colspan="2" class="text-center table-success">Wybornie zarządzasz swoimi finansami</td>
                    </tr>
                    {% elseif expenseSum.sum > incomeSum.sum %}
                    <tr>
                        <td colspan="2" class="text-center table-danger">Wpadniesz w długi!!!</td>
                    </tr>
                    {% else %}
                        <td colspan="2" class="text-center table-info"> Widzę że lubisz życie na krawędzi</td>
                    {% endif %}
                    {% endfor %}
                    {% endfor %}
                    </tbody>
                </table>
                <div class="row">
                    <div class="col" id="piechart_3d_income">
                        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
                        <script type="text/javascript">
                        google.charts.load("current", {packages:["corechart"]});
                        google.charts.setOnLoadCallback(drawChart);						  
                        function drawChart() {							  
                            var data = google.visualization.arrayToDataTable([
                            ['Suma Twoich przychodów', 'Kwota'],
                            ['Wynagrodzenie',  10],
                            ['Odsetki bankowe', 15],
                            ['Sprzedaż na Allegro', 24],
                            ['Inne przychodzy', 12],
                            ]);							

                            var options = {
                            title: 'Przychody',
                            is3D: true,							  						  
                            };

                            var chart = new google.visualization.PieChart(document.getElementById('piechart_3d_income'));
                            chart.draw(data, options);
                        }
                        </script>							
                    </div>
                    <div class="col" id="piechart_3d_expense">
                        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
                        <script type="text/javascript">
                        
                        google.charts.load("current", {packages:["corechart"]});
                        google.charts.setOnLoadCallback(drawChart);
                        function drawChart() {
                            var data = google.visualization.arrayToDataTable([
                            ['Suma Twoich wydatków', 'Kwota'],
                            ['Jedzenie', 13],
                            ['Mieszkanie', 14],
                            ['Transport', 24],
                            ['Telekomunikacja', 53],
                            ['Opieka Zdrowotna', 13],
                            ['Ubranie', 33],
                            ['Higiena', 35],
                            ['Dzieci', 53],
                            ['Rozrywka', 27],
                            ['Wycieczka', 16],
                            ['Szkolenia', 19],
                            ['Książki',3],
                            ['Oszczędności', 8],
                            ['Na emeryturę', 11],
                            ['Spłata długów', 25],
                            ['Darowizna', 13],
                            ['Inne wydatki',  23]
                            ]);

                            var options = {
                            title: 'Wydatki',
                            is3D: true,
                            };							
                            var chart = new google.visualization.PieChart(document.getElementById('piechart_3d_expense'));	
                            
                            chart.draw(data, options);
                        }                           
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}